<!doctype html>
<html>
  <head>
      <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
      <style>
          textarea {
              width: 100%;
          }
      </style>
  </head>
  <body>
    Pyodide test page <br>
    Open your browser console to see Pyodide output
 	  <textarea id="textarea_input" rows="10" placeholder="Once upon a time..."></textarea>
    <br>
    <button id="btn_submit">Submit</button>
    <br>
    <div id="console_output"></div>
    <code>
      x = [1, 2, 3]
      h = [4, 5, 6]


      
      x[n] = δ[n] + 2δ[n-1] + 3δ[n-2]
      h[n] = 4δ[n] + 5δ[n-1] + 6δ[n-2]
      
      y[n] = x[n] * h[n]
      
      y[n] = x[n] * (4δ[n] + 5δ[n-1] + 6δ[n-2])
      y[n] = 4*x[n] + 5*x[n-1] + 6*x[n-2]
      
      y[n] = 
      4*(δ[n] + 2δ[n-1] + 3δ[n-2]) + 
      5*(δ[n-1] + 2δ[n-2] + 3δ[n-3]) + 
      6*(δ[n-2] + 2δ[n-3] + 3δ[n-4])
      
      y[n] = 
      4*δ[n] + 8δ[n-1] + 12δ[n-2] + 
      5δ[n-1] + 10δ[n-2] + 15δ[n-3] + 
      6δ[n-2] + 12δ[n-3] + 18δ[n-4]
      
      
      y[n] = 
      4*δ[n] + 
      8δ[n-1] + 5δ[n-1] + 
      12δ[n-2] + 10δ[n-2] + 6δ[n-2] + 
      15δ[n-3] + 12δ[n-3] + 
      18δ[n-4]
      
      4 11 28 27 18
    </code>
    <script type="text/javascript">
      const code = `import numpy as np
print(np.convolve(np.array([1, 2, 3]), np.array([4, 5, 6])))
`;
        const consoleOutput = document.getElementById("console_output");
     	  const textareaInput = document.getElementById("textarea_input");
        textareaInput.value = code;
      
        const getPyodidePromise = (() => {
        	let pyodide;
            
            return () => new Promise(res => {
            	if (!!pyodide) {
                	console.log("already");
                	res(pyodide);
                } else {
                  loadPyodide({
                    fullStdLib: true,
                    stdout: msg => consoleOutput.innerHTML += `${msg}<br>`,
                  })
                  .then(_pyodide => {
                    console.log(`just now ${!!pyodide ? "overriding..." : "new"}`);
                    pyodide = _pyodide;
                    return pyodide.loadPackage("numpy");
                  })
                  .then(() => res(pyodide));
                }
            })
        })();
        
        document.getElementById("btn_submit").addEventListener("click", function() {
            consoleOutput.innerHTML = "";
        	  getPyodidePromise()
            .then(pyodide => {
              pyodide.runPython(textareaInput.value);
            })
        });
    </script>
  </body>
</html>
