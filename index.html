<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height">
      <base href="/convolution-calculator/">
      <title>Convolution Calculator</title>
      <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
      <style>
          textarea {
              width: 100%;
          }
      </style>
  </head>
  <body>
    <a href="https://github.com/dirkarnez/convolution-calculator/" target="_blank">dirkarnez/convolution-calculator</a><br>
      Pyodide test page <br>
      Open your browser console to see Pyodide output<br>
      <textarea id="textarea-input" rows="10" placeholder="Once upon a time..."></textarea>
    <br>
    <button id="btn-submit">Submit</button>
    <br>
    <div id="console-output"></div>
    <pre><code id="my-notes"></code></pre>
    <script type="text/javascript">
      const code = `import numpy as np
print(np.convolve(np.array([1, 2, 3]), np.array([4, 5, 6])))
`;
        const consoleOutput = document.getElementById("console-output");
     	  const textareaInput = document.getElementById("textarea-input");
          
        textareaInput.value = code;
        const getPyodidePromise = (() => {
          let pyodide;
            
          return () => new Promise(res => {
            if (!!pyodide) {
                console.log("already");
                res(pyodide);
            } else {
              loadPyodide({
                fullStdLib: true,
                stdout: msg => consoleOutput.innerHTML += `${msg}<br>`,
              })
              .then(async _pyodide => {
                    console.log(`just now ${!!pyodide ? "overriding..." : "new"}`);
                    pyodide = _pyodide;
                    return await pyodide.loadPackage(["numpy", "scipy", "micropip"]);
              })
              .then(async () => {
                    const micropip = pyodide.pyimport("micropip");
                    await micropip.install(["sympy"]);
                    res(pyodide);
              });
            }
          });
        })();

        const btnSubmit = document.getElementById("btn-submit");
        btnSubmit.addEventListener("click", function() {
            btnSubmit.innerText = `Submitting...`;
            btnSubmit.disabled = true;
            consoleOutput.innerHTML = "";
            getPyodidePromise()
            .then(pyodide => {
                  btnSubmit.innerText = `Submitted`;
                  pyodide.runPython(textareaInput.value);
            })
            .catch(e => {
                  btnSubmit.innerText = `${e}`;
            })
            .finally(() => {
                  btnSubmit.disabled = false;
            });
        });

        const myNotes = document.getElementById("my-notes");
        myNotes.innerText = `x = [1, 2, 3]
h = [4, 5, 6]


// from https://people.eecs.ku.edu/~perrins/class/F14_360/lab/labnotes4.pdf
x[n] = δ[n] + 2δ[n-1] + 3δ[n-2]
h[n] = 4δ[n] + 5δ[n-1] + 6δ[n-2]

y[n] = x[n] * h[n]

y[n] = x[n] * (4δ[n] + 5δ[n-1] + 6δ[n-2])
y[n] = 4*x[n] + 5*x[n-1] + 6*x[n-2]

y[n] = 
4*(δ[n] + 2δ[n-1] + 3δ[n-2]) + 
5*(δ[n-1] + 2δ[n-2] + 3δ[n-3]) + 
6*(δ[n-2] + 2δ[n-3] + 3δ[n-4])

y[n] = 
4δ[n] + 8δ[n-1] + 12δ[n-2] + 
5δ[n-1] + 10δ[n-2] + 15δ[n-3] + 
6δ[n-2] + 12δ[n-3] + 18δ[n-4]

// rearrange and count occurrence
y[n] = 
4δ[n] + 
8δ[n-1] + 5δ[n-1] + 
12δ[n-2] + 10δ[n-2] + 6δ[n-2] + 
15δ[n-3] + 12δ[n-3] + 
18δ[n-4]

4 13 28 27 18
`;
    </script>
  </body>
</html>
